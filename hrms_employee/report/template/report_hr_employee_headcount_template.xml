<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <!--Employee Headcount Template-->
        <template id="report_hr_employee_headcount_template">
			<t t-call="report.html_container">
				<t t-call="report.external_layout"/>
				<t t-foreach="docs" t-as="o">
					<div class="page">
                            <div style="page-break-before:always;">
                                <div class="text-center">
                                    <t t-if="o.state == 'all'">
                                        <span style="font-weight:bold;font-family:Liberation Sans;font-size:16px;">EMPLOYEE HEADCOUNT<br/></span>
                                    </t>
                                    <t t-if="o.state == 'newly'">
                                        <span style="font-weight:bold;font-family:Liberation Sans;font-size:16px;">NEWLY HIRED EMPLOYEE HEADCOUNT<br/></span>
                                    </t>
                                    <t t-if="o.state == 'separated'">
                                        <span style="font-weight:bold;font-family:Liberation Sans;font-size:16px;">SEPARATED EMPLOYEE HEADCOUNT<br/></span>
                                    </t>
                                    <span style="font-weight:bold;font-family:Liberation Sans;font-size:10px;">AS OF<br/></span>
                                    <span t-if="o.from_date and o.to_date">
                                        <t t-esc="time.strftime('%B %d, %Y', time.strptime(o.from_date,'%Y-%m-%d'))"/> - <t t-esc="time.strftime('%B %d, %Y', time.strptime(o.to_date,'%Y-%m-%d'))"/>
                                    </span>
                                    <span t-if="not o.from_date and not o.to_date">
                                        <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%B %d, %Y')"/>
                                    </span>
                                </div><br/>
                                <span  style="font-weight:bold;font-family:Liberation Sans;font-size:12px;text-align:center;">Date: <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%B %d, %Y %I:%M:%S %p')"/></span><br/>
                                <t t-set="department_ids" t-value="[]"/>
                                <t t-foreach="records.sorted(key=lambda r: r.department_id.name)" t-as="recs">
                                    <t t-set="department_ids" t-value="department_ids+[recs.department_id]"/>
                                </t>
                                <t t-foreach="o.get_sorted(list(set(department_ids)))" t-as="department">
										<span style="font-weight:bold;font-family:Liberation Sans;font-size:14px;" class="text-uppercase"><span t-esc="department.name"/> </span><br/>
                                        <table style="width:100%;text-align:center;font-family:Liberation Sans;border: 1px solid #000000;border-collapse: collapse;">
                                            <tr style="font-size:12px;font-weight:bold;background-color:#d6d8db;text-align:center;border: 1px solid #000000;">
                                                <th style="width:2%;padding:10px;text-align:center;vertical-align:center;">NO</th>
                                                <th style="width:20%;padding:10px;text-align:center;vertical-align:center;" colspan="2">EMPLOYEE NAME</th>
                                                <!--<th style="width:5%;padding:10px;text-align:center;vertical-align:center;">LAST NAME</th>-->
                                                <!--<th style="width:5%;padding:10px;text-align:center;vertical-align:center;">FIRST NAME</th>-->
                                                <!--<th style="width:5%;padding:10px;text-align:center;vertical-align:center;">MIDDLE NAME</th>-->
                                                <th style="width:10%;padding:10px;text-align:center;vertical-align:center;">JOB POSITION</th>
                                                <th style="width:10%;padding:10px;text-align:center;vertical-align:center;">COMPANY</th>
                                                <t t-foreach="o.company_ids" t-as="cid">
                                                    <t t-set="comp" t-value="o.company_env(cid.id)"/>
                                                    <th style="width:5%;padding:8px;text-align:center;vertical-align:center;">
                                                        <span class="text-uppercase" t-esc="comp.partner_id.abbreviation"/>
                                                    </th>
                                                </t>
                                                <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">TOTAL</th>
                                            </tr>
                                            <t t-set="i" t-value="1"/>
                                            <t t-foreach="records" t-as="rec">
                                                <t t-if="rec.department_id.id == department.id">
                                                    <tr style="font-size:12px;">
                                                        <th style="width:2%;padding:10px;text-align:center;vertical-align:center;">
                                                            <span t-esc="i"/>
                                                            <t t-set="i" t-value="i+1"/>
                                                        </th>
                                                        <th style="width:8%;padding:10px;text-align:center;vertical-align:center;">
                                                            <t t-esc="rec.identification_id"/>
                                                        </th>
                                                        <th style="width:12%;padding:10px;text-align:left;vertical-align:center;">
                                                            <span class="text-uppercase" t-esc="rec.name"/>
                                                        </th>
                                                        <!--<th style="width:5%;padding:10px;text-align:left;vertical-align:center;">-->
                                                            <!--<span class="text-uppercase" t-esc="rec.last_name"/>-->
                                                        <!--</th>-->
                                                        <!--<th style="width:5%;padding:10px;text-align:left;vertical-align:center;">-->
                                                            <!--<span class="text-uppercase" t-esc="rec.first_name"/>-->
                                                        <!--</th>-->
                                                        <!--<th style="width:5%;padding:10px;text-align:left;vertical-align:center;">-->
                                                            <!--<span class="text-uppercase" t-esc="rec.middle_name"/>-->
                                                        <!--</th>-->
                                                        <th style="width:5%;padding:10px;text-align:left;vertical-align:center;">
                                                            <span class="text-uppercase" t-esc="rec.job_id.name"/>
                                                        </th>
                                                        <th style="width:5%;padding:10px;text-align:left;vertical-align:center;">
                                                            <span class="text-uppercase" t-esc="rec.company_id.name"/>
                                                        </th>
                                                        <t t-foreach="o.company_ids" t-as="company">
                                                            <!--<t t-set="comp" t-value="company"/>-->
                                                            <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">
                                                                <t t-if="rec.compensation_ids">
                                                                    <t t-foreach="rec.compensation_ids" t-as="compensation">
                                                                        <t t-if="compensation.company_id.id == company.id">
                                                                            <span class="text-uppercase" t-esc="'{0:,.2f}'.format(compensation.shared / 100.0)"/>
                                                                        </t>
                                                                    </t>
                                                                </t>
                                                            </th>
                                                        </t>
                                                        <th style="width:10%;padding:10px;text-align:center;vertical-align:center;">
                                                            <t t-set="total" t-value="0"/>
                                                            <t t-if="rec.compensation_ids">
                                                                <t t-foreach="rec.compensation_ids" t-as="compensation">
                                                                    <t t-set="total" t-value="total+compensation.shared"/>
                                                                </t>
                                                            </t>
                                                            <span class="text-uppercase" t-esc="'{0:,.2f}'.format(total / 100.0)"/>
                                                        </th>
                                                    </tr>
                                                </t>
                                            </t>
                                            <tr style="font-size:12px;border: 1px solid #000000;">
                                                <th style="width:5%;padding:8px;text-align:right;vertical-align:center;" colspan="5">
                                                    <span>TOTAL >>></span>
                                                </th>
                                                <t t-foreach="o.company_ids" t-as="company">
                                                    <!--<t t-set="comp" t-value="o.company_env(company.id)"/>-->
                                                    <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">
                                                        <t t-set="cid_total" t-value="0"/>
                                                        <t t-set="cid_total" t-value="sum([compensation.shared for rec in records if rec.department_id.id == department.id for compensation in rec.compensation_ids if compensation.company_id.id == company.id])"/>
                                                        <t t-esc="'{0:,.2f}'.format(cid_total / 100.0)"/>
                                                    </th>
                                                </t>
                                                <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">
                                                    <t t-set="over_total" t-value="0"/>
                                                    <t t-set="over_total" t-value="sum([compensation.shared for rec in records if rec.department_id.id == department.id for compensation in rec.compensation_ids])"/>
                                                    <t t-esc="'{0:,.2f}'.format(over_total / 100.0)"/>
                                                </th>
                                            </tr>
                                        </table><br/>
                                    <!--</t>-->
                                </t>
                                <span style="font-weight:bold;font-family:Liberation Sans;font-size:14px;" class="text-uppercase">TOTAL HEADCOUNT </span><br/>
                                <table align="middle" style="width:50%;text-align:center;font-family:Liberation Sans;border: 1px solid #000000;border-collapse: collapse;">
                                    <tr style="font-size:12px;font-weight:bold;background-color:#d6d8db;text-align:center;border: 1px solid #000000;">
                                        <t t-foreach="o.company_ids" t-as="cid">
                                            <t t-set="comp" t-value="o.company_env(cid.id)"/>
                                            <th style="width:5%;padding:8px;text-align:center;vertical-align:center;">
                                                <span class="text-uppercase" t-esc="comp.partner_id.abbreviation"/>
                                            </th>
                                        </t>
                                        <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">TOTAL</th>
                                    </tr>
                                    <tr style="font-size:12px;">
                                        <t t-foreach="o.company_ids" t-as="company">
                                            <t t-set="comp" t-value="o.company_env(company.id)"/>
                                            <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">
                                                <t t-set="cid_totalx" t-value="0"/>
                                                <t t-set="cid_totalx" t-value="sum([compensation.shared for rec in records for compensation in rec.compensation_ids if compensation.company_id.id == company.id])"/>
                                                <t t-esc="'{0:,.2f}'.format(cid_totalx / 100.0)"/>
                                            </th>
                                        </t>
                                        <th style="width:5%;padding:10px;text-align:center;vertical-align:center;">
                                            <t t-set="over_totalx" t-value="0"/>
                                            <t t-set="over_totalx" t-value="sum([compensation.shared for rec in records for compensation in rec.compensation_ids])"/>
                                            <t t-esc="'{0:,.2f}'.format(over_totalx / 100.0)"/>
                                        </th>
                                    </tr>
                                </table>
                            </div>
						<!--</t>-->
                    </div>
				</t>
			</t>
        </template>

        <template id="report_hr_employee_headcount_templates" inherit_id="hrms_employee.report_hr_employee_headcount_template">
            <xpath expr="//t[@t-call='report.external_layout']" position="attributes">
                <attribute name="t-call">hrms_employee.external_layout_footer_custom_employee</attribute>
            </xpath>
        </template>
    </data>
</odoo>