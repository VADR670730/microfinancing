<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <template id="report_recruitment_template">
			<t t-call="report.html_container">
				<t t-call="report.external_layout"/>
				<t t-foreach="docs" t-as="o">
                    <div class="page">
                        <t t-set="company_ids" t-value="[]"/>
                        <t t-foreach="records" t-as="recs">
                            <t t-set="company_ids" t-value="company_ids+[recs.company_id]"/>
                        </t>
                        <t t-foreach="set(company_ids)" t-as="company">
                            <div style="page-break-after:always;">
                                <!--<div class="row">-->
                                    <!--<div class="col-xs-3">-->
                                        <!--<img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 50px;"/>-->
                                    <!--</div>-->
                                    <!--<div class="col-xs-9 text-right" style="margin-top:20px;">-->
                                        <!--<span><strong><span class="text-uppercase" t-field="company.name"/></strong><br/>-->
                                            <!--<span t-field="company.rml_header1"/></span>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="row zero_min_height">-->
                                    <!--<div class="col-xs-12">-->
                                        <!--<div style="border-bottom: 1px solid black;"> </div>-->
                                    <!--</div>-->
                                <!--</div>-->

                                    <div class="text-center">
                                        <span style="font-weight:bold;font-family:Liberation Sans;font-size:20px;">APPLICANT MONITORING REPORT</span><br/>
                                        <t t-if="o.to_date and o.from_date">
                                            <span style="font-weight:bold;font-family:Liberation Sans;font-size:10px;">AS OF<br/></span>
                                            <t t-esc="time.strftime('%B %d, %Y', time.strptime(o.from_date,'%Y-%m-%d'))"/> - <t t-esc="time.strftime('%B %d, %Y', time.strptime(o.to_date,'%Y-%m-%d'))"/><br/>
                                        </t>
                                    </div><br/>
                                    <span  style="font-weight:bold;font-family:Liberation Sans;font-size:13px;text-align:center;">Date: <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%B %d, %Y %H:%M:%S')"/></span><br/>
                                    <t t-set="job_position" t-value="[]"/>
                                    <t t-foreach="records" t-as="recs">
                                        <t t-set="job_position" t-value="job_position+[recs.job_id]"/>
                                    </t>
                                    <t t-foreach="set(job_position)" t-as="job">
                                        <t t-if="job.address_id.id == company.partner_id.id">
                                            <span style="font-weight:bold;font-family:Liberation Sans;font-size:16px;" class="text-uppercase" t-esc="job.name"/><br/>
                                            <table style="width:100%;text-align:center;font-family:Liberation Sans;border: 1px solid #000000;border-collapse: collapse;">
                                                <tr style="font-size:12;font-weight:bold;background-color:#d6d8db;text-align:center;border: 1px solid #000000;">
                                                    <th style="width:2%;padding:8px;text-align:center;vertical-align:center;">NO</th>
                                                    <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">CANDIDATE NAME</th>
                                                    <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">BRANCH / DEPARTMENT</th>
                                                    <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">RESPONSIBLE</th>
                                                    <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">RECRUITMENT PROCEDURES</th>
                                                    <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">DATE STARTED</th>
                                                    <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">REMARKS</th>
                                                </tr>
                                                <t t-set="i" t-value="1"/>
                                                <t t-foreach="records.sorted(key=lambda r: r.name)" t-as="rec">
                                                    <t t-if="rec.job_id.id == job.id and rec.company_id.id == company.id">
                                                        <tbody>
                                                            <tr style="font-size:12px;">
                                                                <th style="width:2%;padding:8px;text-align:center;vertical-align:center;">
                                                                    <span t-esc="i"/>
                                                                    <t t-set="i" t-value="i+1"/>
                                                                </th>
                                                                <th style="width:10%;padding:8px;text-align:left;vertical-align:center;">
                                                                    <span class="text-uppercase" t-esc="rec.name"/>
                                                                </th>
                                                                <th style="width:10%;padding:8px;text-align:left;vertical-align:center;">
                                                                    <t t-esc="rec.department_id.name"/>
                                                                </th>
                                                                <th style="width:10%;padding:8px;text-align:left;vertical-align:center;">
                                                                    <t t-esc="o.get_approvers_name(rec.requester_id.id)"/>
                                                                </th>
                                                                <th style="width:10%;padding:8px;text-align:left;vertical-align:center;">
                                                                    <!--<t t-if="not o.stage_state">-->
                                                                        <t t-if="o.set_all_history">
                                                                           <table>
                                                                                <t t-foreach="rec.app_history_id" t-as="history">
                                                                                    <tr style="font-size:12px;">
                                                                                        <th style="width:30%;padding:8px;text-align:left;vertical-align:center;">
                                                                                            <t t-if="history.stage_date">
                                                                                                <span class="text-uppercase" t-esc="history.stage_state.name"/>
                                                                                            </t>
                                                                                        </th>
                                                                                    </tr>
                                                                                </t>
                                                                            </table>
                                                                        </t>
                                                                        <t t-if=" not o.set_all_history">
                                                                            <span class="text-uppercase" t-esc="rec.stage_id.name"/>
                                                                        </t>
                                                                    <!--</t>-->
                                                                    <!--<t t-if="o.stage_state">-->
                                                                        <!--<span class="text-uppercase" t-esc="rec.stage_id.name"/>-->
                                                                    <!--</t>-->
                                                                </th>
                                                                <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">
                                                                    <!--<t t-if="not o.stage_state">-->
                                                                        <t t-if="o.set_all_history">
                                                                            <table>
                                                                                <t t-foreach="rec.app_history_id" t-as="history">
                                                                                    <tr style="font-size:12px;">
                                                                                        <th style="width:30%;padding:8px;text-align:center;vertical-align:center;">
                                                                                            <t t-if="history.stage_date">
                                                                                                <span class="text-uppercase" t-esc="history.stage_date"/>
                                                                                            </t>
                                                                                        </th>
                                                                                    </tr>
                                                                                </t>
                                                                            </table>
                                                                        </t>
                                                                        <t t-if="not o.set_all_history">
                                                                            <span class="text-uppercase" t-esc="rec.date_applied"/>
                                                                        </t>
                                                                    <!--</t>-->
                                                                    <!--<t t-if="o.stage_state">-->
                                                                        <!--<span class="text-uppercase" t-esc="rec.date_applied"/>-->
                                                                    <!--</t>-->
                                                                </th>
                                                                <th style="width:10%;padding:8px;text-align:center;vertical-align:center;">
                                                                    <!--<t t-if="not o.stage_state">-->
                                                                        <t t-if="o.set_all_history">
                                                                            <table>
                                                                            <t t-foreach="rec.app_history_id" t-as="history">
                                                                                <tr style="font-size:12px;">
                                                                                    <th style="width:30%;padding:8px;text-align:center;vertical-align:center;">
                                                                                        <t t-if="history.stage_date">
                                                                                            <span class="text-uppercase" t-esc="history.remarks"/>
                                                                                        </t>
                                                                                    </th>
                                                                                </tr>
                                                                            </t>
                                                                        </table>
                                                                        </t>
                                                                        <t t-if="not o.set_all_history">
                                                                            <span class="text-uppercase" t-esc="rec.remarks"/>
                                                                        </t>
                                                                    <!--</t>-->
                                                                    <!--<t t-if="o.stage_state">-->
                                                                        <!--<span class="text-uppercase" t-esc="rec.remarks"/>-->
                                                                    <!--</t>-->
                                                                </th>
                                                            </tr>
                                                        </tbody>
                                                    </t>
                                                </t>
                                            </table><br/>
                                        </t>
                                    </t>
                            </div>
                        </t>
                    </div>
				</t>
			</t>
        </template>

        <template id="report_recruitment_templates" inherit_id="hrms_employee.report_recruitment_template">
            <xpath expr="//t[@t-call='report.external_layout']" position="attributes">
                <attribute name="t-call">hrms_employee.external_layout_custom_recruitment</attribute>
            </xpath>
        </template>
    </data>
</odoo>