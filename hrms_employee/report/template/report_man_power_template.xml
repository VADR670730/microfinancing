<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <template id="report_man_power_template">
            <t t-call="report.html_container">
				<t t-foreach="docs" t-as="o">
                    <div class="page">
                        <t t-set="department_ids" t-value="[]"/>
                        <t t-foreach="o.department_ids" t-as="recs">
                            <t t-if="not recs.parent_id">
                                <t t-set="department_ids" t-value="department_ids+[recs]"/>
                            </t>
                        </t>
                        <t t-foreach="set(department_ids)" t-as="department">
                            <!--<t t-set="department" t-value="o.get_department(dept)"/>-->
                            <div style="page-break-before:always;">
                                <div class="text-center">
                                    <span style="font-weight:bold;font-family:Liberation Sans;font-size:20px;"><t t-esc="department.name"/>
                                        <t t-if="department.is_branch">
                                            BRANCH
                                        </t>
                                        <t t-if="not department.is_branch">
                                            DEPARTMENT
                                        </t>
                                    </span><br/>
                                    <span style="font-weight:bold;font-family:Liberation Sans;font-size:20px;">MANPOWER PLAN <t t-esc="time.strftime('%Y', time.strptime(o.from_date,'%Y-%m-%d'))"/></span><br/>
                                </div><br/>
                            </div>
                            <t t-set="types" t-value="['MC', 'EPFC', 'SP']"/>
                            <table style="width:100%;text-align:center;font-family:Liberation Sans;border: 1px solid #000000;border-collapse: collapse;">
                                <t t-if="department.is_branch">
                                    <tr style="font-size:12px;font-weight:bold;text-align:center;">
                                        <th style="width:20%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" rowspan="2">POSITION</th>
                                        <th style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" colspan="4">ACTUAL HEADCOUNT</th>
                                        <t t-foreach="months" t-as="month">
                                            <th style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" colspan="3"><t t-esc="month[1]"/> </th>
                                        </t>
                                        <!--<th style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" rowspan="2">TOTAL</th>-->
                                    </tr>
                                    <tr style="font-size:12px;font-weight:bold;text-align:center;">
                                        <th style="width:20%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">

                                        </th>
                                        <t t-foreach="types" t-as="type">
                                            <th style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;"><t t-esc="type"/> </th>
                                        </t>
                                        <t t-foreach="months" t-as="month">
                                            <t t-foreach="types" t-as="type">
                                                <th style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;"><t t-esc="type"/> </th>
                                            </t>
                                        </t>
                                    </tr>
                                </t>
                                <t t-if=" not department.is_branch">
                                    <tr style="font-size:12px;font-weight:bold;text-align:center;">
                                        <th style="width:20%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">POSITION</th>
                                        <th style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">ACTUAL HEADCOUNT</th>

                                        <t t-foreach="months" t-as="month">
                                            <th style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;"><t t-esc="month[1]"/> </th>
                                        </t>
                                        <!--<th style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">TOTAL</th>-->
                                    </tr>
                                </t>

                                <t t-set="count_employees" t-value="0"/>
                                <t t-set="count_mc" t-value="0.0"/>
                                <t t-set="count_epfc" t-value="0.0"/>
                                <t t-set="count_sp" t-value="0.0"/>
                                <t t-set="dept_ids" t-value="[]"/>
                                <t t-set="employees" t-value="o.get_employees(department, o.from_date, o.to_date)"/>
                                <t t-foreach="employees" t-as="employee">
                                    <t t-if="employee.department_id.parent_id">
                                        <t t-set="dept_ids" t-value="dept_ids+[employee.department_id.parent_id]"/>
                                    </t>
                                    <t t-if="not employee.department_id.parent_id">
                                        <t t-set="dept_ids" t-value="dept_ids+[employee.department_id]"/>
                                    </t>
                                </t>
                                <t t-set="grand_total" t-value="[]"/>
                                <t t-set="grand_total_mc" t-value="[]"/>
                                <t t-set="grand_total_epfc" t-value="[]"/>
                                <t t-set="grand_total_sp" t-value="[]"/>
                                <t t-foreach="o.get_sorted(list(set(dept_ids)))" t-as="dept_id">
                                    <!--<tr style="font-size:12px;">-->
                                        <!--<td style="width:20%;padding:8px;text-align:left;vertical-align:center;border-top: 1px solid #000000;border-bottom: 1px solid #000000;">-->
                                            <!--[ <span class="text-uppercase"><span t-esc="dept_id.name"/></span> ] <span class="text-uppercase" t-esc="dept_id.company_id.partner_id.abbreviation"/>-->
                                        <!--</td>-->
                                        <!--<td style="width:5%;padding:8px;text-align:center;vertical-align:center;border-top: 1px solid #000000;border-bottom: 1px solid #000000;">-->
                                            <!--<span> </span>-->
                                        <!--</td>-->
                                        <!--<t t-if="not department.is_branch">-->
                                            <!--<t t-foreach="months" t-as="month">-->
                                                <!--<td style="width:5%;padding:8px;text-align:center;vertical-align:center;border-top: 1px solid #000000;border-bottom: 1px solid #000000;">-->
                                                    <!--<span> </span>-->
                                                <!--</td>-->
                                            <!--</t>-->
                                        <!--</t>-->
                                        <!--<t t-if="department.is_branch">-->
                                            <!--<t t-foreach="types" t-as="type">-->
                                                <!--<th style="padding:8px;text-align:center;vertical-align:center;border-top: 1px solid #000000;border-bottom: 1px solid #000000;"> </th>-->
                                            <!--</t>-->
                                            <!--<t t-foreach="types" t-as="type">-->
                                                <!--<t t-foreach="months" t-as="month">-->
                                                    <!--<td style="padding:8px;text-align:center;vertical-align:center;border-top: 1px solid #000000;border-bottom: 1px solid #000000;">-->
                                                        <!--<span> </span>-->
                                                    <!--</td>-->
                                                <!--</t>-->
                                            <!--</t>-->
                                        <!--</t>-->
                                    <!--</tr>-->
                                    <t t-set="job_ids" t-value="[]"/>
                                    <t t-foreach="records" t-as="rec">
                                        <t t-if="rec.department_id.id == dept_id.id">
                                            <t t-foreach="rec.line_ids" t-as="line">
                                                <t t-set="job_ids" t-value="job_ids+[line.job_id]"/>
                                            </t>
                                        </t>
                                    </t>

                                    <t t-foreach="o.get_sorted(list(set(job_ids)))" t-as="jobs">
                                        <t t-set="last_count" t-value="0"/>
                                        <t t-set="last_mc" t-value="0.0"/>
                                        <t t-set="last_epfc" t-value="0.0"/>
                                        <t t-set="last_sp" t-value="0.0"/>
                                        <t t-set="job_count" t-value="0"/>
                                        <tr style="font-size:12px;">
                                            <td style="width:20%;padding:8px;text-align:left;vertical-align:center;border: 1px solid #000000;">
                                                &#160;&#160;<span class="text-uppercase"><span t-esc="jobs.name"/> </span> [<span class="text-uppercase" t-esc="jobs.address_id.abbreviation"/>]
                                            </td>
                                            <td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                                <span class="text-uppercase"><span t-esc="o.get_count_employees(jobs, department, o.from_date, o.to_date)"/></span>
                                                <t t-set="count_employees" t-value="count_employees + o.get_count_employees(jobs, department, o.from_date, o.to_date)"/>
                                                <t t-set="last_count" t-value="o.get_count_employees(jobs, department, o.from_date, o.to_date)"/>
                                            </td>
                                            <t t-if="not department.is_branch">
                                                <t t-foreach="months" t-as="month">
                                                    <td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                                        <t t-set="count" t-value="0"/>
                                                        <t t-foreach="records" t-as="rec">
                                                            <t t-if="rec.department_id.id == department.id and rec.month_date == month[0]">
                                                                <t t-foreach="rec.line_ids" t-as="line">
                                                                    <t t-if="line.job_id.id == jobs.id">
                                                                        <t t-set="count" t-value="count + line.total"/>
                                                                    </t>
                                                                </t>
                                                            </t>
                                                        </t>
                                                        <t t-if="count &gt; 0">
                                                            <span t-esc="count"/>
                                                            <t t-set="last_count" t-value="count"/>

                                                        </t>
                                                        <t t-if="count == 0">
                                                            <t t-set="count" t-value="last_count"/>
                                                            <span t-esc="count"/>
                                                        </t>
                                                        <t t-set="job_count" t-value="job_count + count"/>
                                                        <t t-set="grand_total" t-value="grand_total + [(department.id,month[0],count)]"/>
                                                    </td>
                                                </t>
                                            </t>
                                            <t t-if="department.is_branch">
                                                <t t-foreach="types" t-as="type">
                                                    <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                                        <t t-set="count" t-value="0"/>
                                                        <t t-foreach="jobs.hr_job_count_ids" t-as="job_type">
                                                            <t t-if="str(job_type.type).upper() == str(type)">
                                                                <t t-set="count" t-value="count + (o.get_count_employees(jobs, department, o.from_date, o.to_date) * (job_type.percentage / 100.00))"/>
                                                                <t t-if="str(job_type.type).upper() == 'MC'">
                                                                    <t t-set="count_mc" t-value="count_mc + count"/>
                                                                    <t t-set="last_mc" t-value="(o.get_count_employees(jobs, department, o.from_date, o.to_date) * (job_type.percentage / 100.00))"/>
                                                                </t>
                                                                <t t-if="str(job_type.type).upper() == 'EPFC'">
                                                                    <t t-set="count_epfc" t-value="count_epfc + count"/>
                                                                    <t t-set="last_epfc" t-value="(o.get_count_employees(jobs, department, o.from_date, o.to_date) * (job_type.percentage / 100.00))"/>
                                                                </t>
                                                                <t t-if="str(job_type.type).upper() == 'SP'">
                                                                    <t t-set="count_sp" t-value="count_sp + count"/>
                                                                    <t t-set="last_sp" t-value="(o.get_count_employees(jobs, department, o.from_date, o.to_date) * (job_type.percentage / 100.00))"/>
                                                                </t>
                                                            </t>
                                                        </t>
                                                        <t t-if="count &gt; 0">
                                                            <span t-esc="count"/>
                                                        </t>
                                                        <t t-set="job_count" t-value="job_count + count"/>
                                                    </td>
                                                </t>
                                                <t t-foreach="months" t-as="month">
                                                    <t t-foreach="types" t-as="type">
                                                        <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                                            <t t-set="count" t-value="0"/>
                                                            <t t-foreach="records" t-as="rec">
                                                                <t t-if="rec.department_id.id == department.id and rec.month_date == month[0]">
                                                                    <t t-foreach="rec.line_ids" t-as="line">
                                                                        <t t-if="line.job_id.id == jobs.id">
                                                                            <t t-foreach="jobs.hr_job_count_ids" t-as="job_type">
                                                                                <t t-if="str(job_type.type).upper() == str(type)">
                                                                                    <t t-set="count" t-value="count + (line.total * (job_type.percentage / 100.00))"/>
                                                                                </t>
                                                                            </t>
                                                                        </t>
                                                                    </t>
                                                                </t>
                                                            </t>
                                                            <t t-if="count &gt; 0">
                                                                <span t-esc="count"/>
                                                                <t t-if="str(type).upper() == 'MC'">
                                                                    <t t-set="last_mc" t-value="count"/>
                                                                </t>
                                                                <t t-if="str(type).upper() == 'EPFC'">
                                                                    <t t-set="last_epfc" t-value="count"/>
                                                                </t>
                                                                <t t-if="str(type).upper() == 'SP'">
                                                                    <t t-set="last_sp" t-value="count"/>
                                                                </t>

                                                            </t>
                                                            <t t-if="count == 0">
                                                                <t t-if="str(type).upper() == 'MC'">
                                                                    <t t-set="count" t-value="last_mc"/>
                                                                </t>
                                                                <t t-if="str(type).upper() == 'EPFC'">
                                                                    <t t-set="count" t-value="last_epfc"/>
                                                                </t>
                                                                <t t-if="str(type).upper() == 'SP'">
                                                                    <t t-set="count" t-value="last_sp"/>
                                                                </t>
                                                                <t t-if="count &gt; 0">
                                                                    <span t-esc="count"/>
                                                                </t>
                                                                <t t-if="count == 0">
                                                                    <span> </span>
                                                                </t>
                                                            </t>
                                                            <t t-if="str(type).upper() == 'MC'">
                                                                <t t-set="grand_total_mc" t-value="grand_total_mc + [(department.id,month[0],type,count)]"/>
                                                            </t>
                                                            <t t-if="str(type).upper() == 'EPFC'">
                                                                <t t-set="grand_total_epfc" t-value="grand_total_epfc + [(department.id,month[0],type,count)]"/>
                                                            </t>
                                                            <t t-if="str(type).upper() == 'SP'">
                                                                <t t-set="grand_total_sp" t-value="grand_total_sp + [(department.id,month[0],type,count)]"/>
                                                            </t>
                                                            <t t-set="job_count" t-value="job_count + count"/>
                                                            <t t-set="grand_total" t-value="grand_total + [(department.id,month[0],count)]"/>
                                                        </td>
                                                    </t>
                                                </t>
                                            </t>
                                            <!--<td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">-->
                                                <!--<span t-esc="job_count"/>-->
                                            <!--</td>-->
                                        </tr>
                                    </t>
                                </t>

                                <tr style="font-size:12px;">
                                    <t t-set="total_count" t-value="0"/>
                                    <td style="width:20%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                        <span>TOTAL</span>
                                    </td>
                                    <td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                        <t t-if="not department.is_branch">
                                            <span class="text-uppercase"><span t-esc="'{0:,.2f}'.format(count_employees)"/></span>
                                        </t>
                                    </td>
                                    <t t-if="not department.is_branch">
                                        <t t-foreach="months" t-as="month">
                                            <td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                                <t t-set="count" t-value="0"/>
                                                <!--<t t-foreach="records" t-as="rec">-->
                                                    <!--<t t-if="rec.department_id.id == department.id and rec.month_date == month[0]">-->
                                                        <!--<t t-foreach="rec.line_ids" t-as="line">-->
                                                            <!--&lt;!&ndash;<t t-if="line.job_id.id == jobs.id">&ndash;&gt;-->
                                                            <!--<t t-set="count" t-value="count + line.total"/>-->
                                                            <!--&lt;!&ndash;</t>&ndash;&gt;-->
                                                        <!--</t>-->
                                                    <!--</t>-->
                                                <!--</t>-->
                                                <t t-foreach="grand_total" t-as="over_all">
                                                    <t t-if="over_all[0] == department.id and over_all[1] == month[0]">
                                                        <t t-set="count" t-value="count + over_all[2]"/>
                                                    </t>
                                                </t>
                                                <!--<t t-foreach="records" t-as="rec">-->
                                                    <!--<t t-if="rec['month_date'] == month[0] and rec['department_id'] == department.id">-->
                                                        <!--<t t-set="count" t-value="count + rec['no_of_recruitment']"/>-->
                                                    <!--</t>-->
                                                <!--</t>-->
                                                <span t-esc="'{0:,.2f}'.format(count)"/>
                                                <t t-set="total_count" t-value="total_count + count"/>
                                            </td>
                                        </t>
                                    </t>
                                    <t t-if="department.is_branch">
                                        <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                            <span class="text-uppercase"><span t-esc="'{0:,.2f}'.format(count_mc)"/></span>
                                        </td>
                                        <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                            <span class="text-uppercase"><span t-esc="'{0:,.2f}'.format(count_epfc)"/></span>
                                        </td>
                                        <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                            <span class="text-uppercase"><span t-esc="'{0:,.2f}'.format(count_sp)"/></span>
                                        </td>
                                        <t t-foreach="months" t-as="month">
                                            <t t-foreach="types" t-as="type">
                                                <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                                    <t t-set="count" t-value="0"/>
                                                    <!--<t t-foreach="records" t-as="rec">-->
                                                        <!--<t t-if="rec.department_id.id == department.id and rec.month_date == month[0]">-->
                                                            <!--<t t-foreach="rec.line_ids" t-as="line">-->
                                                                <!--&lt;!&ndash;<t t-if="line.job_id.id == jobs.id">&ndash;&gt;-->
                                                                <!--<t t-foreach="line.job_id.hr_job_count_ids" t-as="job_type">-->
                                                                    <!--<t t-if="str(job_type.type).upper() == str(type)">-->
                                                                        <!--<t t-set="count" t-value="count + (line.total * (job_type.percentage / 100.00))"/>-->
                                                                    <!--</t>-->
                                                                <!--</t>-->
                                                                <!--&lt;!&ndash;</t>&ndash;&gt;-->
                                                            <!--</t>-->
                                                        <!--</t>-->
                                                    <!--</t>-->
                                                    <t t-if="str(type).upper() == 'MC'">
                                                        <t t-foreach="grand_total_mc" t-as="over_all">
                                                            <t t-if="over_all[2] == type and over_all[0] == department.id and over_all[1] == month[0]">
                                                                <t t-set="count" t-value="count + over_all[3]"/>
                                                            </t>
                                                        </t>
                                                    </t>
                                                    <t t-if="str(type).upper() == 'EPFC'">
                                                        <t t-foreach="grand_total_epfc" t-as="over_all">
                                                            <t t-if="over_all[2] == type and over_all[0] == department.id and over_all[1] == month[0]">
                                                                <t t-set="count" t-value="count + over_all[3]"/>
                                                            </t>
                                                        </t>
                                                    </t>
                                                    <t t-if="str(type).upper() == 'SP'">
                                                        <t t-foreach="grand_total_sp" t-as="over_all">
                                                            <t t-if="over_all[2] == type and over_all[0] == department.id and over_all[1] == month[0]">
                                                                <t t-set="count" t-value="count + over_all[3]"/>
                                                            </t>
                                                        </t>
                                                    </t>
                                                    <span t-esc="'{0:,.2f}'.format(count)"/>
                                                    <t t-set="total_count" t-value="total_count + count"/>
                                                </td>
                                            </t>
                                        </t>
                                    </t>
                                </tr>
                                <t t-if="department.is_branch">
                                    <tr style="font-size:12px;">
                                        <t t-set="total_count" t-value="0"/>
                                        <td style="width:20%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                            <span>TOTAL MC/SP</span>
                                        </td>
                                        <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" colspan="4">
                                            <span class="text-uppercase"><span t-esc="'{0:,.2f}'.format(count_sp + count_mc)"/></span>
                                        </td>
                                        <t t-foreach="months" t-as="month">
                                            <td style="padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" colspan="3">
                                                <t t-set="count" t-value="0"/>
                                                <t t-foreach="grand_total_mc" t-as="over_all">
                                                    <t t-if="(over_all[2]).upper() == 'MC' and over_all[0] == department.id and over_all[1] == month[0]">
                                                        <t t-set="count" t-value="count + over_all[3]"/>
                                                    </t>
                                                </t>
                                                <t t-foreach="grand_total_sp" t-as="over_all">
                                                    <t t-if="(over_all[2]).upper() == 'SP' and over_all[0] == department.id and over_all[1] == month[0]">
                                                        <t t-set="count" t-value="count + over_all[3]"/>
                                                    </t>
                                                </t>
                                                <span t-esc="'{0:,.2f}'.format(count)"/>
                                                <t t-set="total_count" t-value="total_count + count"/>
                                            </td>
                                        </t>
                                    </tr>
                                    <tr style="font-size:12px;">
                                        <td style="width:20%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;">
                                            <span>OVERALL TOTAL</span>
                                        </td>
                                        <td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" colspan="4">
                                            <span class="text-uppercase"><span t-esc="'{0:,.2f}'.format(count_employees)"/></span>
                                        </td>
                                        <t t-foreach="months" t-as="month">
                                            <td style="width:5%;padding:8px;text-align:center;vertical-align:center;border: 1px solid #000000;" colspan="3">
                                                <t t-set="count" t-value="0"/>
                                                <t t-foreach="grand_total" t-as="over_all">
                                                    <t t-if="over_all[0] == department.id and over_all[1] == month[0]">
                                                        <t t-set="count" t-value="count + over_all[2]"/>
                                                    </t>
                                                </t>
                                                <span t-esc="'{0:,.2f}'.format(count)"/>
                                                <t t-set="total_count" t-value="total_count + count"/>
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                            </table><br/>
                            <t t-if="o.notes">
                                <t t-set="string_to_output" t-value="(o.notes).split('\n')" />
                                <span style="font-weight:bold;">Note: </span>
                                <t t-foreach="string_to_output" t-as="string_line">
                                    <strong><span style="font-size:14px;font-weight:bold;display:inline-block;white-space: pre-wrap;" t-esc="string_line"/></strong><br />
                                </t>
                            </t><br/><br/>
                            <div class="row" width="100%">
                                <div class="col-xs-6 text-left">
                                    <span style="font-weight:bold;">Prepared By:</span>
                                </div>
                                <div class="col-xs-6 text-left">
                                    <span style="font-weight:bold;">Approved By:</span>
                                </div>
                            </div><br/><br/>
                            <div class="row" width="100%">
                                <div class="col-xs-3 text-center">
                                    <span style="font-weight:bold;" class="text-uppercase" t-esc="o.get_approvers_name(o.prepared_by.id)"/><br/>
                                    <span class="text-uppercase" t-esc="o.prepared_by_job"/><br/>
                                </div>
                                <div class="col-xs-3 text-center">
                                    <span> </span>
                                </div>

                                <div class="col-xs-3 text-center">
                                    <span style="font-weight:bold;" class="text-uppercase" t-esc="o.get_approvers_name(o.approved_by1.id)"/><br/>
                                    <span class="text-uppercase" t-esc="o.approved_by1_job"/><br/>
                                </div>
                                <div class="col-xs-3 text-center">
                                    <span style="font-weight:bold;" class="text-uppercase" t-esc="o.get_approvers_name(o.approved_by2.id)"/><br/>
                                    <span class="text-uppercase" t-esc="o.approved_by2_job"/><br/>
                                </div>
                            </div>
                        </t>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>